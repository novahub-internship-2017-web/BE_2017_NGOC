9<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>user profile</title>
</head>
<body>

    
    <div class="container">
        <form id="user_edit" class="form-horizontal">
            <div class="row">
                <div class="col-md-3"></div>
                <div class="col-md-6">
                    <h2 style="text-align: center">Edit User</h2>
                    <hr/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3"></div>
                <div class="col-md-6"></div>
            </div>
        </form>
    </div>
    <form id="user_profile_form" style="display: none;">
        <label>email : </label>
        <input type="text" name="email" id="email"/> <br/>
        <label>firstname : </label>
        <input type="text" name="firstName" id="firstName"/> <br/>
        <label>lastName : </label>
        <input type="text" name="lastName" id="lastName"/> <br/>
        <input type="checkbox" name="choice_change_password" id="checkbox_choice_change_password" value="false"/>change password <br/>
        <div id="changing_password_form" style="display: none;">
            <label>password : </label>
            <input type="password" name="password" id="password"/> <br/>
            <label>confirm password</label>
            <input type="password" name="repassword" id="repassword"/> <br/>
        </div>
        <input type="submit" name="submit" value="update"/>
    </form>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script>
        var url = window.location.href;
        var userId = url.substring(url.lastIndexOf('/') + 1);

        $('#checkbox_choice_change_password').change(function () {
            if ($("#checkbox_choice_change_password").is(":checked")) {
                $('#changing_password_form').show();
            } else {
                $('#changing_password_form').hide();
            }
        });

        $('#user_profile_form').submit(function(event) {
            event.preventDefault();

            callUserPostApi();
        });

        function callUserGetApi() {
            $.ajax({
                type: "GET",
                contentType: "application/json",
                url: window.location.origin + "/api/user/" + userId,
                dataType: 'json',
                timeout: 10000,
                success: function (dataReceive) {
                    console.log("SUCCESS : ", dataReceive);
                    $("#email").val(dataReceive.email);
                    $("#firstName").val(dataReceive.firstName);
                    $("#lastName").val(dataReceive.lastName);

                    $("#user_profile_form").show();
                },
                error: function (e) {
                    console.log("ERROR : ", e.responseJSON.message);
                }
            });
        }

        function callUserPostApi(){

            var data;

            if ($("#checkbox_choice_change_password").is(":checked")){
                data = JSON.stringify({
                    "email" : this.email.value,
                    "firstName" : this.firstName.value,
                    "lastName" : this.lastName.value,
                    "password" : this.password.value
                });
            } else {
                data = JSON.stringify({
                    "email": this.email.value,
                    "firstName": this.firstName.value,
                    "lastName": this.lastName.value
                });
            }

            if($("#user_profile_form").valid()) {
                $.ajax({
                    type: "PUT",
                    contentType: "application/json",
                    url: window.location.origin + "/api/user/" + userId,
                    data: data,
                    dataType: 'json',
                    timeout: 10000,
                    success: function (dataReceive) {
                        console.log("SUCCESS : ", dataReceive);
                        $("#message").text("Update user successfully");
                    },
                    error: function (e) {
                        console.log("ERROR : ", e.responseJSON.message);
                        $("#message").text(e.responseJSON.message);
                    }

                    //TODO : handle message when success and error
                });
            }
        }

        document.addEventListener("DOMContentLoaded", function(){
            callUserGetApi();
        });
    </script>



</body>
</html>